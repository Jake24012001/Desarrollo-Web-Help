<div class="card shadow-lg mt-4 mb-5 mx-auto" style="max-width: 600px;">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">Creación de Ticket de Soporte</h5>
  </div>
  <div class="card-body">
    <!-- Formulario para crear ticket -->
    <form class="formulario-peticion" (ngSubmit)="crearTicket()">

      <!-- Tipo de petición -->
      <div class="form-group mb-3">
        <label for="tipoPeticion" class="form-label">Tipo de petición:</label>
        <input type="text" id="tipoPeticion" class="form-control" placeholder="Ingrese su petición"
          [(ngModel)]="tipoPeticion" name="tipoPeticion" required />
      </div>

      <!-- Selección de usuario -->
      <div class="form-group mb-3">
        <label for="usuario" class="form-label">Selecciona un usuario:</label>
        <select id="usuario" class="form-select" [(ngModel)]="usuarioSeleccionado" (change)="onUsuarioChange()" name="usuario" required>
          <option [ngValue]="null" disabled selected>-- Selecciona --</option>
          <option *ngFor="let usuario of usuarios" [ngValue]="usuario">{{ usuario.nombre }}</option>
        </select>
      </div>

      <!-- Asignar trabajo (usuario+rol) -->
      <div class="form-group mb-3">
        <label for="asignarTrabajo" class="form-label">Asignar Trabajo</label>
        <select id="asignarTrabajo" class="form-select" [(ngModel)]="usuarioSeleccionados" name="usuario" required>
          <option [ngValue]="null" disabled selected>-- Selecciona --</option>
          <option *ngFor="let item of rolesus" [ngValue]="item">{{ item.rol.nombre }} - {{ item.usuario.nombre }}</option>
        </select>
      </div>

      <!-- Categoría de equipo y equipos disponibles -->
      <div class="form-group mb-3">
        <label for="producto" class="form-label">
          Categoría de equipo
          <span *ngIf="!usuarioSeleccionado" class="text-muted small">(Selecciona un usuario primero)</span>
        </label>
        <select name="producto" id="producto" class="form-select" [(ngModel)]="productoSeleccionado"
          (change)="filtrarEquiposPorTipo()" [disabled]="!usuarioSeleccionado" required>
          <option value="" disabled selected>-- Selecciona --</option>
          <option *ngFor="let producto of productosUnicos" [value]="producto.type">{{ producto.type }}</option>
        </select>
      </div>

      <div class="form-group mb-3">
        <label for="equipo" class="form-label">
          Equipos disponibles:
          <span *ngIf="!usuarioSeleccionado" class="text-muted small">(Selecciona un usuario primero)</span>
        </label>
        <div class="d-flex gap-2">
          <select id="equipo" class="form-select equipo-select" [(ngModel)]="equipoSeleccionado" 
                  [disabled]="!usuarioSeleccionado || !productoSeleccionado" name="equipo" required>
            <option [ngValue]="null" disabled selected *ngIf="!equiposFiltrados || equiposFiltrados.length === 0">
              <span *ngIf="!usuarioSeleccionado">── Selecciona un usuario primero ──</span>
              <span *ngIf="usuarioSeleccionado && !productoSeleccionado">── Selecciona una categoría primero ──</span>
              <span *ngIf="usuarioSeleccionado && productoSeleccionado">── No hay equipos disponibles ──</span>
            </option>
            <option *ngFor="let equipo of equiposFiltrados" [ngValue]="equipo">
              {{ formatearEquipo(equipo) }}
            </option>
          </select>
        </div>
      </div>

      <!-- Prioridad y detalle -->
      <div class="form-group mb-3">
        <label for="prioridad" class="form-label">Prioridad del ticket:</label>
        <select id="prioridad" class="form-select" [(ngModel)]="prioridadSeleccionada" name="prioridad" required>
          <option value="" disabled selected>-- Selecciona --</option>
          <option *ngFor="let prioridad of ticketPrioridades" [ngValue]="prioridad">{{ prioridad.name }}</option>
        </select>
      </div>

      <div class="form-group mb-3">
        <label for="detallePeticion" class="form-label">Detalle de petición:</label>
        <textarea id="detallePeticion" class="form-control" rows="4" placeholder="Describa su problemática"
          [(ngModel)]="detallePeticion" name="detallePeticion" required></textarea>
      </div>

      <!-- Acciones -->
      <div class="d-flex gap-2 pt-3">
        <button type="submit" class="btn btn-primary btn-lg">Enviar</button>
        <button type="button" class="btn btn-outline-secondary btn-lg" (click)="cancelarAccion()">Cancelar</button>
      </div>

      <!-- Estado inicial -->
      <div class="form-group mt-4 pt-3 border-top">
        <label class="form-label">Estado inicial del ticket:</label>
        <div class="alert alert-success fw-bold p-2 mb-0" role="alert">{{ getEstadoPendiente()?.nombre || 'ABIERTO' }}</div>
      </div>

    </form>
  </div>
</div>